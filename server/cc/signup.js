var responseArray=new Array();function parseResponse(responseString){responseArray.code=responseString.charAt(0);var jsonStart=responseString.indexOf("{");var jsonEnd=responseString.indexOf("}");var jsonString=responseString.substring(jsonStart,jsonEnd+1);if(JSON.parse){responseArray.json=JSON.parse(jsonString)}else{responseArray.json=eval("("+responseString.substring(jsonStart,jsonEnd+1)+")")}responseArray.html=responseString.substring(jsonEnd+1)}(function(e){var d=false;function f(){var j=e("#email"),i=e.trim(j.val()),h=e("#username"),k=e.trim(h.val()),g=e('#password1[type="password"]'),m=e('#password2[type="password"]'),l=e("#termsofuse");if(!g.length){g=e("#password1").next()}if(!m.length){m=e("#password2").next()}e("#email, #username, #password1, #password2").removeClass("error");b("");if(!i||i==j.attr("placeholder")){j.focus();j.addClass("error");b(GT.gettext("Email address required"));return false}if(!i.match(/^([\w\!\#$\%\&\'\*\+\-\/\=\?\^\`{\|\}\~]+\.)*[\w\!\#$\%\&\'\*\+\-\/\=\?\^\`{\|\}\~]+@((((([a-z0-9]{1}[a-z0-9\-]{0,62}[a-z0-9]{1})|[a-z])\.)+[a-z]{2,6})|(\d{1,3}\.){3}\d{1,3}(\:\d{1,5})?)$/i)){j.focus();j.addClass("error");b(GT.gettext("Invalid email address"));return false}if(!k||k==h.attr("placeholder")){h.focus();h.addClass("error");b(GT.gettext("Please enter your display name"));return false}if(!g.val()){e("#password1").focus();g.addClass("error");b(GT.gettext("Password required"));return false}if(g.val().length<=3){e("#password1").focus();g.addClass("error");b(GT.gettext("Password must be longer than 3 characters"));return false}if(!m.val()){e("#password2").focus();m.addClass("error");b(GT.gettext("Confirm password required"));return false}if(g.val()!=m.val()){m.val("").focus().addClass("error");b(GT.gettext("Password and Confirm Password do not match"));return false}if(!l.attr("checked")){l.focus();b(GT.gettext("You have to agree to the Terms of Use"));return false}return true}function b(g){e("#signup_form_message").html(g)}function a(){if(!f()){return}if(d){return}d=true;e.post("/ajax/doSignUp",e("#signup_form").serialize(),function(g){parseResponse(g);if(responseArray.code==0){e(document).trigger("user.signup")}else{d=false;b(responseArray.json.error)}})}function c(h){var g=e("#username");var j=h.indexOf("@");if(j>0){g.val(h.substring(0,j))}}e(document).ready(function(){e("#signup_submit").live("click",function(g){g.preventDefault();a()});e("#email").bind("blur",function(g){c(e(this).val())})})})(jQuery);
