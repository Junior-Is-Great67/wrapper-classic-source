if(!Array.prototype.some){Array.prototype.some=function(b){var a=this.length;if(typeof b!="function"){throw new TypeError()}var d=arguments[1];for(var c=0;c<a;c++){if(c in this&&b.call(d,this[c],c,this)){return true}}return false}}var Picker={AUTH_SCOPE:"http://www.google.com/m8/feeds/",CONTACTS_URL:"http://www.google.com/m8/feeds/contacts/default/full",GROUPS_URL:"http://www.google.com/m8/feeds/groups/default/full",GROUPS_PANE_ID:"picker_groups_pane",CONTACTS_PANE_ID:"picker_contacts_pane",INFO_PANEL_ID:"picker_info_pane",INFO_CONTAINER_ID:"picker_info_container",GROUPS_LIST_ID:"picker_groups",CONTACT_LIST_ID:"picker_contacts",GROUP_SELECTED_CLASS:"picker_selected",GROUP_END_SPECIAL_CLASS:"picker_endspecial",CONTACT_SELECTED_CLASS:"picker_selected",CONTACT_INFO_BLOCK_CLASS:"picker_info_block",CONTACT_INFO_TITLE_CLASS:"picker_info_title",CONTACT_INFO_META_CLASS:"picker_info_meta",GOOGLE_MAPS_QUERY_URL:"http://maps.google.com/?q=",serviceName:0,contactsService:0,container:0,groupSelector:0,userAddCallback:0,userRemoveCallback:0,errorCallback:0,selectedGroup:0,selectedUser:0,selectedUsers:[],processGroupFeed:function(j){var h=j.feed.entry;var f=document.createElement("ul");f.id=Picker.GROUPS_LIST_ID;var l=document.createElement("li");l.id="picker-group-all";l.className=Picker.GROUP_END_SPECIAL_CLASS;var c=document.createElement("a");c.setAttribute("href","javascript:Picker.displayContactGroup('"+Picker.CONTACTS_URL+"', '"+l.id+"')");c.appendChild(document.createTextNode("All Contacts"));l.appendChild(c);f.appendChild(l);for(var g=0;g<h.length;g++){var k=h[g];var d=document.createElement("li");d.id="picker-group-"+g;var e=document.createElement("a");e.setAttribute("href","javascript:Picker.displayContactGroup('"+k.getId().getValue()+"', '"+d.id+"')");var b=k.getTitle().getText();e.appendChild(document.createTextNode(b));d.appendChild(e);f.appendChild(d)}var a=document.getElementById(Picker.GROUPS_PANE_ID);var m=document.getElementById(Picker.GROUPS_LIST_ID);a.replaceChild(f,m);Picker.displayContactGroup(Picker.CONTACTS_URL,l.id)},processContactFeed:function(k){var g=k.feed.entry;var c=document.createElement("ul");c.id=Picker.CONTACT_LIST_ID;for(var e=0;e<g.length;e++){var m=g[e];var b=m.getId().getValue();var h=document.createElement("li");h.id="picker_contact_"+e;var n=document.createElement("a");n.setAttribute("href","javascript:Picker.showContactDetails('"+b+"', '"+h.id+"')");var f=document.createElement("input");f.type="checkbox";f.name="contact_emails[]";f.id="contact_selector_"+e;var j=Picker.selectedUsers.some(function(i){return(i==f.value)});if(j){f.checked=true}f.onclick=function(){Picker.updateStatus(this.id)};var a=0;if(m.getTitle()&&m.getTitle().getText()){a=m.getTitle().getText()}else{if(m.getEmailAddresses()){a=m.getEmailAddresses()[0].getAddress()}else{a="Untitled Contact"}}f.value=a+";"+m.getEmailAddresses()[0].getAddress();var l=document.createTextNode(a);n.appendChild(l);h.appendChild(f);h.appendChild(n);c.appendChild(h)}var d=document.getElementById(Picker.CONTACTS_PANE_ID);var o=document.getElementById(Picker.CONTACT_LIST_ID);d.replaceChild(c,o)},processContactDetails:function(a){var G=a.entry;var v=document.createElement("div");v.id=Picker.INFO_PANEL_ID;var t=document.createElement("div");t.className=Picker.CONTACT_INFO_BLOCK_CLASS;var r=G.getTitle();if(r&&r.getText()){var s=document.createElement("p");s.className=Picker.CONTACT_INFO_TITLE_CLASS;s.appendChild(document.createTextNode(r.getText()));t.appendChild(s)}var B=G.getEmailAddresses();for(var R=0;R<B.length;R++){var z=B[R];if(z.getAddress()){var Q=document.createElement("p");var b=document.createElement("a");var M=z.getAddress();b.setAttribute("href","mailto:"+M);b.appendChild(document.createTextNode(M)),Q.appendChild(b);t.appendChild(Q)}}var o=G.getOrganizations();if(o[0]){var H=o[0].getOrgTitle();if(H&&H.getValue()){var y=document.createElement("p");y.appendChild(document.createTextNode(H.getValue()));t.appendChild(y)}var J=o[0].getOrgName();if(J&&J.getValue()){var F=document.createElement("p");F.appendChild(document.createTextNode(J.getValue()));t.appendChild(F)}}v.appendChild(t);var S=document.createElement("div");S.className=Picker.CONTACT_INFO_BLOCK_CLASS;var U=G.getPhoneNumbers();for(var R=0;R<U.length;R++){var p=U[R];if(p.getValue()){var u=document.createElement("p");var E=p.getValue();u.appendChild(document.createTextNode(E+" "));var D=document.createElement("span");D.className=Picker.CONTACT_INFO_META_CLASS;var g=0;if(p.getLabel()){g=p.getLabel()}else{if(p.getRel()){g=p.getRel();g=g.substring(33,g.length)}}if(g){D.appendChild(document.createTextNode(g));u.appendChild(D)}S.appendChild(u)}}v.appendChild(S);var h=document.createElement("div");h.className=Picker.CONTACT_INFO_BLOCK_CLASS;var m=G.getImAddresses();for(var R=0;R<m.length;R++){var c=m[R];if(c.getAddress()){var N=document.createElement("p");var j=c.getAddress();N.appendChild(document.createTextNode(j+" "));var x=document.createElement("span");x.className=Picker.CONTACT_INFO_META_CLASS;if(c.getProtocol()){var C=c.getProtocol();C=C.substring(33,C.length).toLowerCase();x.appendChild(document.createTextNode(C));N.appendChild(x);h.appendChild(N)}}}v.appendChild(h);var f=document.createElement("div");f.className=Picker.CONTACT_INFO_BLOCK_CLASS;var d=G.getPostalAddresses();for(var R=0;R<d.length;R++){var k=d[R];if(k.getValue()){var O=document.createElement("p");var e=k.getValue();var K=Picker.GOOGLE_MAPS_QUERY_URL+e;while(K.match("\n")){K=K.replace("\n",", ")}var w=document.createElement("a");w.setAttribute("href",K);w.appendChild(document.createTextNode("map"));while(e.match("\n")){e=e.replace("\n","<br />")}O.innerHTML=e+"<br />";var l=document.createElement("span");l.className=Picker.CONTACT_INFO_META_CLASS;var L=k.getRel();L=L.substring(33,L.length).toLowerCase();l.appendChild(document.createTextNode(L));O.appendChild(l);O.appendChild(document.createTextNode(" - "));O.appendChild(w);f.appendChild(O)}}v.appendChild(f);var q=document.createElement("div");q.className=Picker.CONTACT_INFO_BLOCK_CLASS;var P=G.getContent();if(P&&P.getText()){var T=document.createElement("p");var n=P.getText();T.appendChild(document.createTextNode(n));q.appendChild(T)}v.appendChild(q);var A=document.getElementById(Picker.INFO_CONTAINER_ID);var I=document.getElementById(Picker.INFO_PANEL_ID);A.replaceChild(v,I)},callUserAddCallback:function(b){var c=b.entry;var d=c.getId().getValue();var a=Picker.selectedUsers.some(function(e){return(e==d)});if(!a){Picker.selectedUsers.push(d)}else{Picker.error("Attempt to add a contact which has already been added.")}if(Picker.userAddCallback!=0&&typeof(Picker.userAddCallback)!="undefined"){Picker.userAddCallback(c)}else{Picker.error("User callback function undefined: userAddCallback")}},callUserRemoveCallback:function(c){var d=c.entry;var e=d.getId().getValue();var a=false;for(var b=0;b<Picker.selectedUsers.length;b++){if(Picker.selectedUsers[b]==e){a=true;break}}if(a){Picker.selectedUsers.splice(b,1)}else{Picker.error("Attempt to remove a contact which has not been added.")}if(Picker.userRemoveCallback!=0&&typeof(Picker.userRemoveCallback)!="undefined"){Picker.userRemoveCallback(d)}else{Picker.error("User callback function undefined: userRemoveCallback")}},login:function(a){if(this.serviceName!=0&&typeof(this.serviceName)!="undefined"){if(a==null||a==undefined){set_cookie("gmaillogin","1")}google.accounts.user.login(this.AUTH_SCOPE);this.contactsService=new google.gdata.contacts.ContactsService(this.serviceName)}else{this.error("Service name undefined, call setServiceName()")}},logout:function(){google.accounts.user.logout();this.container.innerHTML='<br/><br/><br/><br/><br/><br/><h3 align=\'center\'>Please sign in to Google to use this feature.<br/>You will be redirected to Google to sign in.</h3><br/><p align=\'center\'><input style="margin-right:20px;" class="btn_sty" type=\'button\' value=\'Sign In\' onclick=\'Picker.login()\' /><input class="btn_sty" type="button" value="Cancel" onclick="showContact()" /></p>'},error:function(a){if(this.errorCallback!=0&&typeof(this.errorCallback)!="undefined"){this.errorCallback(a)}else{alert(a)}},setServiceName:function(a){this.serviceName=a},setErrorCallback:function(a){this.errorCallback=a},setUserAddCallback:function(a){this.userAddCallback=a},setUserRemoveCallback:function(a){this.userRemoveCallback=a},showContactDetails:function(c,a){this.contactsService.getContactEntry(c,this.processContactDetails,this.error);if(this.selectedContact!=0&&typeof(this.selectedContact)!="undefined"){this.selectedContact.className=""}var b=document.getElementById(a);b.className=this.CONTACT_SELECTED_CLASS;this.selectedContact=b},updateStatus:function(b){var a=document.getElementById(b);var d=a.value;var c=a.checked;if(c==true){this.contactsService.getContactEntry(d,this.callUserAddCallback,this.error)}else{this.contactsService.getContactEntry(d,this.callUserRemoveCallback,this.error)}},populateGroups:function(){var a=new google.gdata.contacts.ContactQuery(this.GROUPS_URL);a.setParam("max-results",1000);this.contactsService.getContactGroupFeed(a,this.processGroupFeed,this.error)},displayContactGroup:function(c,b){var a=document.getElementById(b);if(this.selectedGroup!=0&&typeof(this.selectedGroup)!="undefined"){if(this.selectedGroup.className==this.GROUP_SELECTED_CLASS+" "+this.GROUP_END_SPECIAL_CLASS){this.selectedGroup.className=this.GROUP_END_SPECIAL_CLASS}else{this.selectedGroup.className=""}}if(a.className==this.GROUP_END_SPECIAL_CLASS||a.className==this.GROUP_SELECTED_CLASS+" "+this.GROUP_END_SPECIAL_CLASS){a.className=this.GROUP_SELECTED_CLASS+" "+this.GROUP_END_SPECIAL_CLASS}else{a.className=this.GROUP_SELECTED_CLASS}this.selectedGroup=a;var d=new google.gdata.contacts.ContactQuery(this.CONTACTS_URL);d.setParam("max-results",1000);if(c!=Picker.CONTACTS_URL){d.setParam("group",c)}this.contactsService.getContactFeed(d,this.processContactFeed,this.error)},render:function(b){var c=document.createElement("style");c.setAttribute("type","text/css");var e="      #"+b+" {        font: 100% Arial, sans-serif;        -moz-border-radius: 3px;        -webkit-border-radius: 3px;        position: relative;        top: 0.5em;      }            #"+b+" div {        height: 100%;        float: left;        margin: 0;        padding: 0;      }            #"+b+" div#picker_header_pane {        height: 32px;        background: transparent url(/static/go/img/v2/nav_bg.gif) repeat-x scroll 0 0;        vertical-align: middle;        width: 100%;      }            #"+b+" div#picker_groups_container {        width: 25%;        height: 200px;        position: relative;        border-right: 2px solid #c3d9ff;      }            #"+b+" div#picker_contacts_container {        width: 40%;        height: 200px;        position: relative;        border-right: 2px solid #c3d9ff;      }            #"+b+" div#picker_info_container {        width: 33%;        height: 200px;        position: relative;      }            #"+b+" div.picker_column {        width: 100%;      }            #"+b+" div#picker_groups_pane {        position: static;        overflow: auto;      }            #"+b+" div#picker_groups_pane li {        overflow: hidden;      }            #"+b+" div#picker_groups_pane li a {        width: 9999%;      }            #"+b+" div#picker_contacts_pane {        position: static;        overflow: auto;      }            #"+b+" div#picker_contacts_pane li {        overflow: hidden;      }            #"+b+" div#picker_contacts_pane li a {        width: 9999%;      }            #"+b+" div#picker_info_pane {        width: 100%;        position: relative;        overflow: auto;      }            #"+b+" div#picker_footer_pane {        height: 32px;        background-color: #ACCBE0;        vertical-align: middle;        width: 100%;        clear: both;        /*float: none;*/      }            #"+b+" #picker_title {        font-weight: bold;        margin: 0;        padding: 0.4em;        height: 100%;        vertical-align: middle;        font-size: 125%;      }            #"+b+" ul {        list-style-type: none;        padding: 0;        margin: 0;      }            #"+b+" li {        margin: 0;        padding: 2px 5px;        height: 1.3em;        line-height: 1.3em;      }            #"+b+" li input {        margin: 0 3px;      }            #"+b+" li.picker_endspecial {        border-bottom: 1px solid #c3d9ff;      }            #"+b+" li a {        color: #000;        text-decoration: none;      }            #"+b+" li.picker_selected, #"+b+" li.picker_selected:hover {        background-color: #c3d9ff;        color: #0000cc;        font-weight: bold;      }            #"+b+" li.picker_selected a, #"+b+" li.picker_selected:hover a {        color: #0000cc;      }            #"+b+" li:hover {        background-color:  #ffffcc;      }            #"+b+" ."+Picker.CONTACT_INFO_BLOCK_CLASS+" {        float: none;        width: 95%;        position: static;        padding: 0.5em;        height: auto;      }            #"+b+" #picker_info_pane p {        margin: 0;        padding: 0;      }            #"+b+" ."+Picker.CONTACT_INFO_TITLE_CLASS+" {        font-weight: bold;        font-size: 1.1em;      }            #"+b+" ."+Picker.CONTACT_INFO_META_CLASS+" {        color: #777;      }            #"+b+" #picker_logout {        margin: 0 1em;        line-height: 32px;      }            #"+b+" #picker_logout a {        text-decoration: none;      }";if(c.styleSheet){c.styleSheet.cssText=e}else{var f=document.createTextNode(e);c.appendChild(f)}document.getElementsByTagName("head")[0].appendChild(c);this.container=document.getElementById(b);google.gdata.client.init(this.error);if(google.accounts.user.checkLogin(this.AUTH_SCOPE)){delete_cookie("gmaillogin");this.login(false);var d='<div id="picker_header_pane"><p id="picker_title">Import GMAIL Contacts</p></div>';d+='<div id="picker_groups_container"><div id="picker_groups_pane" class="picker_column"><ul id="picker_groups"></ul></div></div>';d+='<div id="picker_contacts_container"><div id="picker_contacts_pane" class="picker_column"><ul id="picker_contacts"></ul></div></div>';d+='<div id="picker_info_container"><div id="picker_info_pane" class="picker_column"></div></div>';d+='<div id="picker_footer_pane"><div style="width:100px;display:inline;"><input class="btn_sty" style="float:right;margin-top:5px;" type="button" name="import" value="Import" onclick="importEmailContacts(\'addgmail\', \'Gmail\')"/></div><div style="width:100px;display:inline;"><input class="btn_sty" style="float:right;margin-top:5px;" type="button" value="Cancel" onclick="showContact()" /></div><p align="right" id="picker_logout"><a href="javascript:Picker.logout()">&raquo; Logout</a></p></div>';this.container.innerHTML=d;var a=this.populateGroups()}else{this.container.innerHTML='<br/><br/><br/><br/><br/><br/><h3 align=\'center\'>Please sign in to Google to use this feature.<br/>You will be redirected to Google to sign in.</h3><br/>          <p align=\'center\'><input style="margin-right:20px;" class="btn_sty" type=\'button\' value=\'Sign In\'          onclick=\'Picker.login()\' /><input class="btn_sty" type="button" value="Cancel" onclick="showContact()" /></p>'}}};
